<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.preview">
	
	<insert id="buyreviewinsert" parameterType="com.banana.vo.ReviewVO">
		insert into banana_buy_review values
		<choose>
  			<when test="rfile != null">
  				('BR_'||sqe_banana_buy_review.nextval,#{pid},#{mid},#{score},#{review},#{rfile},#{rsfile},sysdate)
  			</when>
  			<otherwise>
  				('BR_'||sqe_banana_buy_review.nextval,#{pid},#{mid},#{score},#{review},'','',sysdate)
  			</otherwise>
  		</choose>
	</insert>
	
	<insert id="sellreviewinsert" parameterType="com.banana.vo.ReviewVO">
		insert into banana_sell_review values
		<choose>
  			<when test="rfile != null">
  				('SR_'||sqe_banana_sell_review.nextval,#{pid},#{mid},#{score},#{review},#{rfile},#{rsfile},sysdate)
  			</when>
  			<otherwise>
  				('SR_'||sqe_banana_sell_review.nextval,#{pid},#{mid},#{score},#{review},'','',sysdate)
  			</otherwise>
  		</choose>
	</insert>
	
	<select id="getlist" resultType="com.banana.vo.ReviewVO" >
		select rid,pid,m.mid,r.score,review, rfile, rsfile, rdate, maddr
		from banana_member m ,
			(select rid,pid,mid,score,review, rfile, rsfile, rdate
			  from banana_buy_review
			  union
			  select rid,pid,mid,score,review, rfile, rsfile, sdate
			  from banana_sell_review )r
			where m.mid= r.mid 
			order by rdate desc
	</select> 
	
	
	<select id="getbuylist" resultType="com.banana.vo.ReviewVO" >
		select rid,pid,m.mid,r.score,review, rfile, rsfile, rdate, maddr
		from banana_member m , banana_buy_review r
		where m.mid= r.mid 
		order by rdate desc
	</select> 
	
	<select id="getselllist" resultType="com.banana.vo.ReviewVO" >
		select rid,pid,m.mid,r.score,review, rfile, rsfile, sdate, maddr
		from banana_member m , banana_sell_review r
		where m.mid= r.mid 
		order by sdate desc
	</select> 
</mapper>